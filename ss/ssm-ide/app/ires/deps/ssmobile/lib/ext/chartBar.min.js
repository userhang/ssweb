/*! ssmobile 2014-02-18 */
!function (a) {
    a.ssm && a.ssm.addExtension(function () {
        var b = function (b, c, d) {
            function e() {
                var c = document.createElement("canvas");
                c.id = b + "_1", c.width = r.c_width, c.height = r.c_height, c.style.position = "absolute", c.style.left = 21 + 6 * (v.toString().length + 1), "" == q.yaixs_label && (c.style.left = 5 + 6 * (v.toString().length + 1)), c.style.top = 30, n.appendChild(c);
                var d = c.getContext("2d");
                d.beginPath(), d.strokeStyle = "#A0A0A0", d.moveTo(r.x_start, r.c_height - r.y_start), d.lineTo(r.x_start, r.y_start), d.lineTo(r.c_width + r.x_start, r.y_start), d.stroke();
                var e = document.createElement("canvas");
                e.id = b + "_2", e.width = 20 + 6 * (v.toString().length - 1), e.height = r.c_height, e.style.position = "absolute", e.style.left = 16, "" == q.yaixs_label && (e.style.left = 0), e.style.top = 30, n.appendChild(e);
                var f = e.getContext("2d"), g = document.createElement("canvas"), i = a(g);
                i.addClass("YAXIS_LABEL"), g.height = 130 * q.yaixs_label.length, o.append(g);
                var k = g.getContext("2d");
                k.save(), k.rotate(270 * Math.PI / 180), k.translate(-(130 * q.yaixs_label.length + 100), 0), k.font = "130px Microsoft YaHei", k.fillStyle = "#666", k.textBaseline = "middle";
                var l = k.measureText(q.yaixs_label);
                i.css({top: r.c_height / 2 - l.width / 40}), k.fillText(q.yaixs_label, 100, 60), k.restore();
                var m = a(document.createElement("div"));
                m.addClass("AXIS XAXIS"), m.css({
                    left: 26 + 6 * (v.toString().length + 1),
                    width: r.c_width
                }), "" == q.yaixs_label && m.css({
                    left: 10 + 6 * (v.toString().length + 1),
                    width: r.c_width
                }), o.append(m);
                var p = document.createElement("canvas"), t = a(p);
                t.addClass("XAXIS_LABEL"), p.width = 130 * q.xaixs_label.length, m.append(t);
                var u = p.getContext("2d");
                u.font = "130px Microsoft YaHei", u.fillStyle = "#666", u.textBaseline = "middle";
                var l = u.measureText(q.xaixs_label);
                t.css({left: r.c_width / 2 - l.width / 20}), u.fillText(q.xaixs_label, 0, 60);
                for (var w = 0; w < r.data_count; w++) {
                    var C = document.createElement("canvas"), E = a(C);
                    C.width = q.item_width / 4 * 30, E.addClass("XAXIS_TICK"), m.append(E);
                    {
                        C.getContext("2d")
                    }
                }
                var F = m.children(".XAXIS_TICK");
                for (w = 0; 5 >= w; w++) {
                    d.beginPath(), d.strokeStyle = "#A0A0A0";
                    var G = r.x_start, H = r.y_start - B * w, I = r.c_width + r.x_start, J = r.y_start - B * w;
                    d.moveTo(G, H), d.lineTo(I, J), d.stroke(), f.fillStyle = "#A0A0A0";
                    var K = j(v), L = z + w * A, M = L.toFixed(K);
                    f.fillText(M, G, H + 3)
                }
                for (w = 0; w < r.data_count; w++) {
                    d.beginPath(), d.lineWidth = q.item_width, d.strokeStyle = q.item_color, x = r.x_start + D * (w + 1), y = r.y_start, d.moveTo(x, y);
                    var N = r.y_start - h(s[w]);
                    d.lineTo(x, N), d.stroke(), F.eq(w).css({left: x - q.item_width / 2 - 5});
                    var O = F.eq(w).get(0).getContext("2d");
                    O.font = "95px Microsoft YaHei", O.fillStyle = "#A0A0A0", O.textBaseline = "middle", 0 == q.xaixs_tick.length ? O.fillText(w + 1, 0, 70) : O.fillText(q.xaixs_tick[w], 0, 60)
                }
            }

            function f(a) {
                for (var b = a[0], c = 1; c < a.length; c++)a[c] > b && (b = a[c]);
                return b
            }

            function g(a) {
                for (var b = a[0], c = 1; c < a.length; c++)a[c] < b && (b = a[c]);
                return b
            }

            function h(a) {
                var b = m();
                a -= z;
                var c = b * a / (w - z);
                return c
            }

            function i(a) {
                var b, c;
                a > 1 ? (a = Math.ceil(a), b = a.toString().length - 2) : b = 1 - a.toString().length;
                var c = 5 * Math.pow(10, b);
                return c
            }

            function j(a) {
                var b = a;
                b = b.toString();
                var c = b.indexOf(".");
                if (c >= 0)var d = b.length - c - 1; else var d = 0;
                return d
            }

            function k(a) {
                var b = a / v, c = Math.ceil(b) * v;
                return a == c && (b /= .9, c = Math.ceil(b) * v), c
            }

            function l(a) {
                var b = a / v, c = Math.floor(b) * v;
                return a == c && (b /= .9, c = Math.floor(b) * v), a > 0 && (c = 0), c
            }

            function m() {
                return parseInt(2 * r.y_start - r.c_height)
            }

            var n = document.getElementById(b), o = a(n);
            o.css({position: "relative"});
            var p = {
                title: "Bar Chart",
                background: "rgb(255,253,246)",
                item_width: 30,
                item_color: "rgb(75,178,197)",
                xaixs_tick: [],
                xaixs_label: "",
                yaixs_label: "",
                height: 300,
                width: a(window).width()
            }, q = a.extend({}, p, d);
            o.css({background: q.background, height: q.height, width: q.width});
            var r = {
                x_start: 5,
                y_start: q.height - 80,
                c_width: q.width - 40,
                c_height: q.height - 60,
                data_count: c.length
            }, s = c, t = f(s), u = g(s), v = i(t), w = k(t), z = l(u), A = (w - z) / 5, B = m() / 5, C = document.createElement("div");
            C.width = r.c_width, o.append(a(C)), a(C).addClass("CHARTTITLE"), a(C).text(q.title);
            var D = r.c_width / (r.data_count + 1);
            D - q.item_width < 8 && (D = 8 + parseInt(q.item_width), r.c_width = D * (r.data_count + 1), o.width(r.c_width + 40), o.parent().css({overflowX: "auto"})), e(), window.onorientationchange = function () {
                setTimeout(function () {
                    o.html(""), ssM.chartBar(b, c, d)
                }, 70)
            }
        };
        return publicObj = {chartBar: b}
    })
}(Zepto);