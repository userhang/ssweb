/**
 * Created by Administrator on 2014/11/16.
 */
// JavaScript Document
(function($)
{
    $.ssm&&$.ssm.addExtension(function()
    {
        var usingTime = 0;
        var falseLoop;
        window.load = start();
        function start(setting)
        {
            function addZero(n)
            {
                return n < 10 ? '0' + n : '' + n;
            }
            if (setting == undefined) {
                var nowDate;
                var nowYear;
                var nowMonth;
                var nowDay;
                var nowHour;
                var nowMinute;
                var nowSecond;
                var year = $(".timeYear");
                var month = $(".timeMonth");
                var day = $(".timeDay");
                var hour = $(".timeHour");
                var minute = $(".timeMinute");
                var second = $(".timeSecond");
                function falseRunTime() {
                    nowDate = new Date();
                    nowYear = addZero(nowDate.getFullYear());
                    nowMonth = addZero(nowDate.getMonth());
                    //console.log(nowMonth);
                    nowMonth = parseInt(nowMonth) + 1;
                    nowMonth = nowMonth.toString();
                    nowDay = addZero(nowDate.getDate());
                    nowHour = addZero(nowDate.getHours());
                    nowMinute = addZero(nowDate.getMinutes());
                    nowSecond = addZero(nowDate.getSeconds());
                    year.text(nowYear);
                    month.text(nowMonth);
                    day.text(nowDay);
                    hour.text(nowHour);
                    minute.text(nowMinute);
                    second.text(nowSecond);
                }
                if (usingTime == 0) {
                    falseLoop = setInterval(falseRunTime, 1000);
                }
            }
            else if(setting != undefined)
            {
                var nowDate;
                var nowYear;
                var nowMonth;
                var nowDay;
                var nowHour;
                var nowMinute;
                var nowSecond;
                var defaults;
                var settings;
                var year = $(".timeYear");
                var month = $(".timeMonth");
                var day = $(".timeDay");
                var hour = $(".timeHour");
                var minute = $(".timeMinute");
                var second = $(".timeSecond");

                var nowBackgroundColor = $(".timeShow").css("background-color");
                var nowFontColor = $(".timeWord").css("color");
                var nowNumColor = $(".timeNum").css("color");
                checkSetting(setting);
                function checkSetting(setting)
                {
                    nowDate = new Date();
                    nowYear = addZero(nowDate.getFullYear());
                    nowMonth = addZero(nowDate.getMonth());
                    //console.log(nowMonth);
                    nowMonth = parseInt(nowMonth) + 1;
                    nowMonth = nowMonth.toString();
                    //console.log(nowMonth);
                    //console.log(typeof(nowYear));
                    nowDay = addZero(nowDate.getDate());
                    nowHour = addZero(nowDate.getHours());
                    nowMinute = addZero(nowDate.getMinutes());
                    nowSecond = addZero(nowDate.getSeconds());
                    defaults={
                        year 			: nowYear,
                        month 			: nowMonth,
                        day 			: nowDay,
                        hour 			: nowHour,
                        minute 			: nowMinute,
                        second 			: nowSecond,
                        backgroundColor         : nowBackgroundColor,
                        fontColor 		: nowFontColor,
                        numColor 		: nowNumColor
                    };
                    settings=$.extend({},defaults,setting);
                    changeColor();
                    if(parseInt(settings.year) < 0)
                    {
                        alert("输入年份数据错误，请重新输入！");
                        return;
                    }
                    if(parseInt(settings.month) < 0 || parseInt(settings.month) > 12)
                    {
                        alert("输入月份数据错误，请重新输入！");
                        return;
                    }
                    var checkMaxDay = getDay(parseInt(settings.year), parseInt(settings.month));
                    if(parseInt(settings.day) < 0 || parseInt(settings.day) > checkMaxDay)
                    {
                        alert("输入的日期数据错误，请重新输入！");
                        return;
                    }
                    if(parseInt(settings.hour) < 0 || parseInt(settings.hour) > 24)
                    {
                        alert("输入的小时数据错误，请重新输入！");
                        return;
                    }
                    if(parseInt(settings.minute) < 0 || parseInt(settings.minute) > 60)
                    {
                        alert("输入的分钟数据错误，请重新输入！");
                        return;
                    }
                    if(parseInt(settings.second) < 0 || parseInt(settings.second) > 60)
                    {
                        alert("输入的秒钟数据错误，请重新输入!");
                    }
                    changeTime(settings);
                }

                function changeColor()
                {
                    $(".timeShow").css("background-color",settings.backgroundColor);
                    $(".timeWord").css("color", settings.fontColor);
                    $(".timeNum").css("color", settings.numColor);
                }

                function changeTime(settings)//替换
                {

                    $(".timeYear").text(settings.year);
                    $(".timeMonth").text(settings.month);
                    $(".timeDay").text(settings.day);
                    $(".timeHour").text(settings.hour);
                    $(".timeMinute").text(settings.minute);
                    $(".timeSecond").text(settings.second);
                }
                function runTime()
                {
                    var maxDay;
                    var getNowYear = parseInt($(".timeYear").text());
                    var getNowMonth = parseInt($(".timeMonth").text());
                    var getNowDay = parseInt($(".timeDay").text());
                    var getNowHour = parseInt($(".timeHour").text());
                    var getNowMinute = parseInt($(".timeMinute").text());
                    var getNowSecond = parseInt($(".timeSecond").text());

                    ++getNowSecond;

                    if(getNowSecond >= 60)
                    {
                        getNowSecond = 0;
                        getNowMinute++;
                    }
                    if(getNowMinute >= 60)
                    {
                        getNowMinute = 0;
                        getNowHour++;
                    }
                    if(getNowHour >= 24)
                    {
                        getNowHour = 0;
                        getNowDay++;
                    }
                    maxDay = getDay(getNowYear, getNowMonth);
                    if(getNowDay > maxDay)
                    {
                        getNowDay = 0;
                        getNowMonth++;
                    }
                    if(getNowMonth >= 13)
                    {
                        getNowMonth = 0;
                        getNowYear++;
                    }

                    //判断日期
                    //console.log(getNowSecond);
                    getNowYear = addZero(getNowYear);
                    getNowMonth = addZero(getNowMonth);
                    getNowDay = addZero(getNowDay);
                    getNowHour = addZero(getNowHour);
                    getNowMinute = addZero(getNowMinute);
                    getNowSecond = addZero(getNowSecond);
                    $(".timeYear").text(getNowYear);
                    $(".timeMonth").text(getNowMonth);
                    $(".timeDay").text(getNowDay);
                    $(".timeHour").text(getNowHour);
                    $(".timeMinute").text(getNowMinute);
                    $(".timeSecond").text(getNowSecond);
                    //调用函数。实现时间走
                }
                function getDay(year, month)
                {
                    var returnDay;
                    if(year%400 == 0)
                    {
                        //闰年
                        switch(month)
                        {
                            case 1:
                            case 3:
                            case 5:
                            case 7:
                            case 8:
                            case 10:
                            case 12:returnDay = 31;break;
                            case 2:returnDay = 29;break;
                            case 4:
                            case 6:
                            case 9:
                            case 11:returnDay = 30;break;
                            //default:returnDay = -1;break;
                        }
                    }
                    else
                    {
                        //平年
                        switch(month)
                        {
                            case 1:
                            case 3:
                            case 5:
                            case 7:
                            case 8:
                            case 10:
                            case 12:returnDay = 31;break;
                            case 2:returnDay = 28;break;
                            case 4:
                            case 6:
                            case 9:
                            case 11:returnDay = 30;break;
                            //default:returnDay = -1;break;
                        }
                    }
                    return returnDay;
                }

                clearInterval(falseLoop);
                setInterval(runTime, 1000);
            }

        }

        publicObj={start:start};
        return publicObj

    })
})(Zepto)